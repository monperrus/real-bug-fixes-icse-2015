{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12326016","self":"https://issues.apache.org/jira/rest/api/latest/issue/12326016","key":"DERBY-728","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-01-05 09:35:11.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22116","customfield_12310222":"1_*:*_1_*:*_156432866939_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-11-09T14:54:29.939+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-728/watchers","watchCount":1,"isWatching":false},"created":"2005-11-25T01:20:03.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["gsoc","mentor"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"15.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12334152","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334152","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12475553","key":"DERBY-4827","self":"https://issues.apache.org/jira/rest/api/2/issue/12475553","fields":{"summary":"Modify the documentation for the 10.7 release regarding the UTF-8 CCSID manager","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12315745","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12315745","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"32841","key":"DERBY-310","self":"https://issues.apache.org/jira/rest/api/2/issue/32841","fields":{"summary":"Document and/or change Derby client code to match behavior with Embedded driver where possible.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12314777","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12314777","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12360734","key":"DERBY-2251","self":"https://issues.apache.org/jira/rest/api/2/issue/12360734","fields":{"summary":"When I Create a table with Chinese table name , ij report IO exception.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12333882","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333882","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12474035","key":"DERBY-4799","self":"https://issues.apache.org/jira/rest/api/2/issue/12474035","fields":{"summary":"IllegalArgumentException when generating error message on server","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12330803","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12330803","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12459231","key":"DERBY-4584","self":"https://issues.apache.org/jira/rest/api/2/issue/12459231","fields":{"summary":"Unable to connect to network server if client thread name has Japanese characters","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12333978","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333978","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12474527","key":"DERBY-4805","self":"https://issues.apache.org/jira/rest/api/2/issue/12474527","fields":{"summary":"Increase the length of the RDBNAM field in the DRDA implementation","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-02T02:29:33.864+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"}],"timeoriginalestimate":null,"description":"Trying to create a database with the following URL (note the Chinese character in the database name):\r\n\r\njdbc:derby://localhost:1527/\\u4e10;create=true\r\n\r\nthrows the following exception:\r\n\r\n-----%<-----\r\nException in thread \"main\" org.apache.derby.client.am.SqlException: Unicode string can't convert to Ebcdic string\r\n        at org.apache.derby.client.net.EbcdicCcsidManager.convertFromUCS2(Unknown Source)\r\n        at org.apache.derby.client.net.Request.writeScalarPaddedString(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnectionRequest.buildRDBNAM(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnectionRequest.buildACCSEC(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnectionRequest.writeAccessSecurity(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnection.writeServerAttributesAndKeyExchange(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnection.flowServerAttributesAndKeyExchange(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)\r\n        at org.apache.derby.client.net.NetConnection.<init>(Unknown Source)\r\n        at org.apache.derby.jdbc.ClientDriver.connect(Unknown Source)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:525)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:193)\r\n        at jdbctest.Main.main(Main.java:33)\r\n-----%<-----\r\n\r\nIt's possible, however, to create databases using the embedded driver, using an URL like:\r\n\r\njdbc:derby:\\u4e10;create=true\r\n\r\nTested with both 10.1.1.0 and 10.1.2.1 with the same result.\r\n\r\nComplete code to reproduce the bug:\r\n\r\n-----%<-----\r\npublic static void main(String[] args) throws Exception {\r\n    Class.forName(\"org.apache.derby.jdbc.ClientDriver\");\r\n    Connection conn = DriverManager.getConnection(\"jdbc:derby://localhost:1527/\\u4e10;create=true\");\r\n}\r\n-----%<-----\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10363","value":"Embedded/Client difference","id":"10363"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37000","summary":"Unable to create databases whose name containg Chinese characters through the client driver","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrei.badea","name":"andrei.badea","emailAddress":"andrei dot badea at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrei Badea","active":true},"subtasks":[{"id":"12411902","key":"DERBY-4004","self":"https://issues.apache.org/jira/rest/api/2/issue/12411902","fields":{"summary":" Remove required RDBNAM from ACCSEC. Use SECCHK RDBNAM if none is provided on ACCSEC","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}},{"id":"12411968","key":"DERBY-4008","self":"https://issues.apache.org/jira/rest/api/2/issue/12411968","fields":{"summary":"Only send RDBNAM on ACCSEC if EBCDIC conversion is possible","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}},{"id":"12411969","key":"DERBY-4009","self":"https://issues.apache.org/jira/rest/api/2/issue/12411969","fields":{"summary":"Accommodate  length delimited DRDA strings where character  length does not equal byte length","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}},{"id":"12469536","key":"DERBY-4746","self":"https://issues.apache.org/jira/rest/api/2/issue/12469536","fields":{"summary":"(Server) Implement UTF8 support on DRDA","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}},{"id":"12470520","key":"DERBY-4757","self":"https://issues.apache.org/jira/rest/api/2/issue/12470520","fields":{"summary":"(Client) Implement UTF8 support on DRDA","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrei.badea","name":"andrei.badea","emailAddress":"andrei dot badea at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrei Badea","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Debian unstable, LInux 2.6.14.2, libc 2.3.5-6","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":55,"total":55,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12361802","id":"12361802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Quite likely, some common bug underlies this problem and Derby-708.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2006-01-05T09:35:11.000+0000","updated":"2006-01-05T09:35:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12437472","id":"12437472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"body":"This is not related to Derby-708. This works in the embedded driver, but the path is encoded in EBCDIC (default DRDA encoding) between network client and server, and thus a character set equivalent to ISO-8859-1 is supported. This does *not* include chinese characters.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"created":"2006-09-25T07:06:39.000+0000","updated":"2006-09-25T07:06:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12475210","id":"12475210","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I ran into another occurrence of this while looking at the tests databasePermissions.java and databasePermissions_net.java. The 'embedded' version is made to run some subcases using Greek characters as username and password, networkserver/derbynetclient doesn't. \r\nWhen you attempt to modify this so network server uses the user name and password strings with non-ascii (Greek, in this case) characters you bump into the same error (22005.S.3 / CANT_CONVERT_UNICODE_TO_EBCDIC) in org.apache.derby.client.net.EbcdicCcsidManager.convertFromUCS2. \r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-02-23T00:22:16.283+0000","updated":"2007-02-23T00:22:16.283+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12650339","id":"12650339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Bernt said in this issue:\r\n\"... the path is encoded in EBCDIC (default DRDA encoding) between network client and server, and thus a character set equivalent to ISO-8859-1 is supported. This does *not* include chinese characters.\"\r\n\r\nAre we locked into EBCDIC for this initial negotiation?  I believe for data transfer etc, we use UTF-8.  Could we change future versions to use UTF-8 for negotiating the databasename, user and password, or would that be in violation of the standard?\r\n\r\nThanks\r\n\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-11-24T21:49:26.996+0000","updated":"2008-11-24T21:49:26.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652169","id":"12652169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I did a quick prototype of Network server/client  using a UTF8CcsidManager and was able to connect to the chinese database, but I don't see how we could implement this change and maintain compatibility with earlier versions.  All of the exchange of server attributes is done in the CCSID manager  encoding so we couldn't negotiate which CcsidManager to use.  Are we just stuck until version 11 or does someone have an idea how to manage this?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-12-01T21:49:37.468+0000","updated":"2008-12-01T21:49:37.468+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652176","id":"12652176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I was wondering that until we have a long term solution in version 11, should we provide support for this in earlier versions by having a property which can be used to indiciate UTF8 rather than EBCDIC? Just a suggestion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2008-12-01T22:04:42.398+0000","updated":"2008-12-01T22:04:42.398+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652189","id":"12652189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I know in general the community has avoided such properties, but perhaps it is justified in this case since there seems to be no other alternative.  For client we would need to use a system property, since there is no derby.properties file for the client side.  It seems a little messy to me, but the upside is that it would be a change that we could backport, so users could benefit immediately.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-12-01T22:45:38.931+0000","updated":"2008-12-01T22:45:38.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652356","id":"12652356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I noticed in the drda spec:\r\n4.3.1.13 CCSID Manager\r\nThe CCSIDMGR allows the specification of a single-byte character set CCSID to be associated\r\nwith character typed parameters on DDM command and DDM reply messages. The CCSID\r\nmanager level of the application requester is sent on the EXCSAT command and specifies the\r\nCCSID that the application requester will use when sending character command parameters.\r\n\r\nSo on the one hand it looks like there is the facility to specify a CCSID to use. I think it would be 1208 for UTF-8, but it explicitly says it should be a single-byte character set, so perhaps using UTF-8 is not in compliance with DRDA. But later in an  example it mentions a server with CCSID 1208.\r\n\r\n4.3.5.2 Examples\r\nBelow is a simple example of intermediate server processing. The example assumes that each\r\nserver has a different CCSID, indicated in the diagram generically as ebcdic, unicode, or ascii. In\r\nthe figure, the upstream requester has an EBCDIC CCSID (such as CCSID 37), the intermediate\r\nserver has a Unicode CCSID (such as CCSID 1208)...\r\n\r\nSo I am not totally sure whether it is legal or not.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-12-02T13:19:05.911+0000","updated":"2008-12-02T13:19:05.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652641","id":"12652641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"Here's a possible workaround for this problem that bypasses DRDA compliance issues.  It's not elegant but makes it possible to address this issue without changing the DRDA protocol.  The idea is supporting database path aliases as a property.  This may have other benefits / uses as well.  Your thoughts please.\r\n\r\n   Idea:\r\nI know that some databases [maybe even DB2? DB2 uses DRDA and does not encounter this problem] store location (host / port / path / name [or alias]) information in a file.  Could we implement something similar (database names/aliases) using derby properties that can be read by Network server from the derby.properties file to resolve database names on the connection URL?  For the server-side you would only,  I think, need to specify the absolute or relative path to the database.  \r\n\r\nThis seems innocuous enough a feature that we could backport to the older codelines to resolve this issue?  It would only impact existing implementations that chose to set the property.\r\n\r\nIt struck me that something like what is done for the USER property might work well: \r\n\tderby.dbalias.myDbAlias=<Yada-Path>/realDbName\r\nAnd the connection URL would list only 'myDbAlias'??  I guess this would have to override derby.system.home and be overridded if the conneciton URL looked like a PATH?  There are probably other issues I have not thought of.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2008-12-03T01:18:12.537+0000","updated":"2008-12-03T17:33:30.785+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12652913","id":"12652913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The Properties javadoc says of load ...\r\n\r\n\"the input/output stream is encoded in ISO 8859-1 character encoding. Characters that cannot be directly represented in this encoding can be written using Unicode escapes  ; only a single 'u' character is allowed in an escape sequence.\"\r\n\r\nSo users should be able to specify  Chinese characters in the properties file with some effort.  So, this might be an option if we can't find a DRDA solution. I would be interested to hear from users whether this a workable option.  I can imagine the characters being in an install path and as part of the install the application would need to generate a derby.properties file with the aliases which might be a pain, but I am just speculating on usage.\r\n\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-12-03T19:26:06.105+0000","updated":"2008-12-03T19:26:06.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12655228","id":"12655228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Just one quick comment here. I once started looking at this issue and I i got some way towards a solution. My impression from looking at the DRDA spec is that it may not be THEORETICALLY possible (because of limitations such as those mentioned by Kathey), but in PRACTICE there should be possible to extend Derby's driver to use a different encoding and fall back to the old behavior when connected to an old server. It should be simple to make the server compatible with the new Derby client, old Derby client, DB2 client or the ODBC client. \r\n\r\nI think I still have the work that I did on this lying around. I can try to make a patch of it, but I can't guarantee that the patch can be made against the latest trunk. That patch would by no means be a polished solution, but could perhaps be a starting point...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-12-10T14:40:10.739+0000","updated":"2008-12-10T14:40:10.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12655235","id":"12655235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Here is a patch containing the work I had in my sandbox. It is made against\r\nrev 660997. Updating to the current trunk produced one conflict in DRDAConnThread.java that dodn't look too bad but I'm not sure how to resolve it...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-12-10T14:59:38.673+0000","updated":"2008-12-10T14:59:38.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12655236","id":"12655236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Dyre,\r\n\r\nI would be very interested to see your work on this issue.\r\n\r\nI too am working on a prototype to negotiate the encoding in the MGRLVLS during EXCSAT and am having good results connecting old server with new client and new server with old client.  It ends up that the local DRDA experts are working on a preliminary ACR to do this.  I should be able to post my  prototype and the details of the ACR in January. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-12-10T15:03:03.444+0000","updated":"2008-12-10T15:03:03.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12655962","id":"12655962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Hi Kathey, \r\n\r\nmy work on this issue should be in the patch. When working on it, I didn't really aim for a minimal solution, so it may be possible to achieve this with less work than what my patch suggests.\r\n\r\nBased on what I can remember it seems like you are on the right track. Once the negotiating is working you just need to go through the code to find all the places where it is assumed that a given string length will fit in the same number of bytes. That isn't too bad as I recall, but there are some sticky points where a string, encoded in the negotiated charset, should be placed in DRDA fields which are specified with a fixed BYTE size, and should be padded to the correct size with space chars. This is simple as long as you can rely on the space character fitting in one byte, but when supporting encodings such as UCS-2 where space is two bytes, you can no longer use Arrays.fill() directly...\r\n\r\nI also think there is a DRDA field where you are supposed to fill in the client's ip-address (or part of it) as a string in the negotiated charset, and that the number of bytes you can use is not enough to encode in UCS-2. But I think I concluded that this field is not used for anything important, so deviating from the spec here should not be a problem... ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-12-12T10:34:28.685+0000","updated":"2008-12-12T10:34:28.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12661713","id":"12661713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I have been talking with the local DRDA experts and found out that they are working on a new DRDA ACR for a UNICODEMGR which I think can help us with this issue.  The  short summary is this:\r\n\r\nEXCSAT and ACCSEC are always sent EBCDIC.  As part of the MGRLVL exchange,  client sends UNICODEMGR 1208 which means that it is requesting all additional DDM parameters will be exchanged in code page 1208.  The server responds with UNICODEMGR 1208 if it can accommodate the request.  Otherwise it responds with UNICODEMGR 0 and all DDM parameters will continue to be exchanged in EBCDIC.\r\n\r\nOne problem with this approach is that ACCSEC currently has an RDBNAM parameter which we treat as required (the spec lists it as optional) and that has to be sent EBCDIC.  So, my proposal is that we use the UNICODEMGR and we send  RDBNAM on ACCSEC *only if*  the EBCDIC conversion can be done.   If the conversion can't be done, we send no RDBNAM on ACCSEC.  Then we change the server to use the RDBNAM sent with the unicode  SECCHK instead of the one sent on ACCSEC.   (Currently we just verify that the SECCHK RDBNAM is the same as the one that was sent on ACCSEC.)\r\n \r\nFor an old client working with a new server, there will be no regression and the error message on sending a database name with international characters will be the same as currently listed in \r\nDERBY-728.\r\n\r\nFor a new client working with a old server, this will mean that  all the cases that currently pass will still pass, but if a nonconvertible database name is sent (e,g, one with Chinese \r\ncharacters) , the server will send back a SYNTAXRM and the \r\nserver console will show:\r\n  = 2110; Error Code Value = e. Plaintext connection attempt \r\nfrom an SSL enabled client?\r\norg.apache.derby.impl.drda.DRDAProtocolException: Execution \r\nfailed because of a Distributed Protocol Error:  DRDA_Proto_\r\nSYNTAXRM; CODPNT arg  = 2110; Error Code Value = e. Plaintext \r\nconnection attempt from an SSL enabled client?\r\n        at \r\norg.apache.derby.impl.drda.DRDAConnThread.throwSyntaxrm(DRDAConn\r\nThread.java:513)\r\n        at \r\norg.apache.derby.impl.drda.DRDAConnThread.missingCodePoint(DRDAC\r\nonnThread.java:543)\r\n        at \r\norg.apache.derby.impl.drda.DRDAConnThread.parseACCSEC(DRDAConnTh\r\nread.java:1948)\r\n        at \r\norg.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDACo\r\nnnThread.java:943)\r\n        at \r\norg.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.jav\r\na:290)\r\n\r\n\r\nThe client could intercept the SYNTAXRM and  knowing it was unable to convert the RDBNAM to EBCDIC could throw the same message it does now.  The only regression  would be that users attempting to send an invalid database name would now see the server side protocol error occur. I think it  is an acceptable regression, since it won't cause any working  cases to fail even with mixed revision server/client and it will enable us to move forward and have internationalized  database name, user and password.  \r\n\r\nI prototyped the change and it all seemed to work ok.  I'll attach the prototype patch.\r\n\r\nI  would like to implement as much as possible of this for 10.5, but since approval of the ACR by opengroup won't happen by the time we release 10.5, I propose to make the implementation dependent on a client system property derby.drda.unicodemgr=true.  This would be false by default but could be switch to true in a maintenance release once opengroup approval occurs. Currently the hope is to have the ACR available publicly by the end of January.  Then I would need Rick's help to try to push it through opengroup since he is our opengroup rep.  I don't know how long that takes.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-01-07T21:21:12.399+0000","updated":"2009-01-07T21:21:12.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12661729","id":"12661729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attaching prototype of changes.  This patch is *not* for commit. The prototype implements UNICODEMGR manager level to negotiate DDM parameter encoding.  There are some places where performance degredation could occur which need to be addressed and some other issues in comments in the code.  The prototype implementation adds a UTF8CcsidManager to client and server and switches the ccsidmgr in the DDMReader and DDMWriter based on the negotiated encoding.  Probably that is not the clearest implementation since the new thing is called a UNICODEMGR not a CCSIDMANAGER, but this was the quickest way to implement the prototype.   I haven't thought of a better way to do it yet but am open to suggestions.\r\n\r\n\r\nThe actual implementation will be in subtasks of this issue.  \r\n\r\n- Remove required RDBNAM from ACCSEC\r\n- Client should only send RDBNAM on ACCSEC if EBCDIC conversion is possible.\r\n-  Accomidate length delimited DRDA strings where string length does not equal byte length.\r\n- Implement UNICODEMGR support.  Perhaps this can be broken up into subtasks but hopefully won't be too big ones the other three are done.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-01-07T21:55:59.188+0000","updated":"2009-01-07T21:55:59.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12665886","id":"12665886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"In the reproduction for this issue there is a Chinese character \\u4e10.  I'd like to know if anyone knows the meaning of this character before I put it in a bunch of tests.\r\n\r\nThanks\r\n\r\nKathey\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-01-21T17:37:38.100+0000","updated":"2009-01-21T17:37:38.100+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12666535","id":"12666535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"According to http://translate.google.com it means \"[Formal] a beggar\", but I don't speak Chinese, so I really can't say.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-23T12:56:25.038+0000","updated":"2009-01-23T12:56:25.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12668631","id":"12668631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I also found some web sites that indicate something like that, I think it's safe enough to use in tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-01-29T22:10:31.821+0000","updated":"2009-01-29T22:10:31.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12699421","id":"12699421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is ACR7007: a proposed change to the DRDA spec for UNICODEMGR, which will allow us to implement a fix for  this issue.  The ACR was developed within IBM with plans to present it to opengroup for approval.  The authors said I could post it here so Derby could benefit and provide comments.  Ultimately IBM will submit this to opengroup for incorporation in the spec.  \r\n\r\nPlease take a look and post any comments to this issue. Rick may be especially interested as our representative at opengroup.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-04-15T22:34:55.481+0000","updated":"2009-04-15T22:34:55.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12699554","id":"12699554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"At the risk of pointing out the obvious, I tested this on the 10.5 RC1 using ij and the issue does not arise.\r\n\r\nInterestingly enough, the folder that is created for the database seems to have the Unicode representation of the character and is just called: u4e10\r\n\r\nI'm just wondering whether it isn't somehow assuming the u4e10 as a string literal rather than a Unicode character.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-04-16T06:57:13.133+0000","updated":"2009-04-16T06:57:13.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12699684","id":"12699684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Tiago said:\r\n>I'm just wondering whether it isn't somehow assuming the u4e10 as a string literal >rather than a Unicode character. \r\n\r\nYes, ij doesn't support escaped unicode characters. You have to use a java program, e.g.\r\nConnection  conn = DriverManager.getConnection(\"jdbc:derby://localhost:1527/\\u4e10;create=true\");","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-04-16T12:52:24.544+0000","updated":"2009-04-16T12:52:24.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12700281","id":"12700281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Kathey,\r\n\r\nThanks for attaching the proposed change to Volume 1 of the DRDA spec. It got me thinking about SQL identifiers. It seems from the changes to chapters 6 and 7 on page 5 that DRDA still thinks that sql identifiers are limited to 255 bytes. I don't know where this limitation actually surfaces. It doesn't surface in the simple test I have attached (BigTableName) which pokes and peeks a table whose schema name and table name are each 128 unicode characters long, represented in utf-8 as 384 bytes apiece.\r\n\r\nBut it may prevent us from extending our DRDA or SQL support in the future. The maximum length of a SQL identifier is 128 unicode characters, according to part 2 of the 2008 SQL Standard, section 5.2 (<token> and <separator>), syntax rule (13). Derby supports this maximum length. At two bytes per Java character, this works out to 256 bytes, not 255. Since each unicode character can potentially expand to 4 bytes in UTF-8 encoding, the maximum length of a UTF-8 encoded identifier is 512 bytes. I believe that DRDA's sql identifiers should be at least 256 bytes long and probably 512 bytes.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2009-04-17T18:52:15.062+0000","updated":"2009-04-17T18:52:15.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12700286","id":"12700286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thank you Rick for looking at this.\r\n\r\nI too am concerned about the  DRDA 255 byte character string limit.  I had thought of it especially in terms of this feature as users may have much longer paths for database name. I think this general limit extension needs to be addressed as a different ACR.    I think we should open a separate issue for it and pursue it as a separate ACR with opengroup.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-04-17T19:02:16.927+0000","updated":"2009-04-17T19:02:16.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12734177","id":"12734177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Unassigning this issue.  I have not had time to focus on it and don't want to prevent someone else from picking it up.\r\n\r\nI think the spec proposal is complete and the prototype is based on that and seems to work ok.  The hardest part seems to be DERBY-4009 to check the byte length limitations because we need to perform the check before we send and currently we do the byte conversion at a pretty low level during the send.  The prototype doesn't have the checks.\r\n\r\nAnother issue regarding this change may whether to implement it before it officially gets into the spec.  I was thinking maybe the initial implementation could be based on a property which would be made the default when the ACR is accepted,. On the other hand there are no user interfaces affected, so maybe it would be ok to go ahead and implement it.  We have I think implemented some protocol  extensions for setQueryTimeout and session caching that are Derby specific, but I may be wrong on that.  This may also be a non-issue at the current rate of progress.\r\n\r\nAnyway, please feel free to pick up on this issue. I will provide any assistance I can.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-07-22T16:08:48.222+0000","updated":"2009-07-22T16:08:48.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12834517","id":"12834517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I wanted to mention that this ACR 7007 has enterered the opengroup fast track process for review.  Rick is the Derby representative at opengroup.   Hopefully Rick and the entire opengroup review team will find the ACR in good order and we can implement DERBY-728 to the new specification.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-02-16T22:24:33.497+0000","updated":"2010-02-16T22:24:33.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12844376","id":"12844376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I marked this issue with labels mentor and gsoc.  I would be willing to mentor  a returning student in this project, but think it is probably not a good starting project for someone just joining derby.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-03-12T05:43:16.281+0000","updated":"2010-03-12T05:43:16.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12867328","id":"12867328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I was recently discussing UNICODEMGR implementation with some engineers working on other database products.  The topic of the encoding for embedded character data in PRDDTA and CRRTKN came up.  The fields themselves are architected in DRDA as BYTSTRDR - Byte String, but do contain character data.  The question was whether the character data should be UNICODE  if UNICODEMGR was being used or should remain EBCDIC.  I was asked how it will be in Derby's implemenation. I think it should be UNICODE. It just makes more sense (to me)  and is how the current code will work, but should be limited to single byte characters.   Let me know if you have a different opinion or better ideas.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-05-14T00:13:30.564+0000","updated":"2010-05-14T00:13:30.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12867548","id":"12867548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I am probably garbling this, since I don't have the DRDA context in my head, but how would this help create database names with Chinese characters? AFAIK they are encoded in Unicode with 3 bytes (UTF-8), not single bytes..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-14T16:22:14.842+0000","updated":"2010-05-14T16:22:14.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12868713","id":"12868713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"@ Kathey:\r\nI do agree with you, if the UNICODE format is chosen, it should be used to all subsequent exchanges of data. If DRDA specifies this field as byte string, then I suppose the encoding is left to the discretion of the implementation.\r\n\r\n@ Dag:\r\nIn actual fact it wouldn't help the database names but I think for matters of coherence, if the UNICODE format is agreed upon between the parties, then it should be used for all cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-05-18T16:31:38.197+0000","updated":"2010-05-18T16:31:38.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12868784","id":"12868784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Where does the single-byte character restriction come from? If the standard just says these objects contain byte strings, I'd assume we are allowed to encode multi-byte characters in them too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-05-18T18:48:32.104+0000","updated":"2010-05-18T18:48:32.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12873444","id":"12873444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I've had a talk with Kathey about how to approach this issue and here's a summary of what was discussed.\r\n\r\nEssentially Kathey explained to me what she implemented in the derby-728_proto_diff.txt prototype. Based on this, we decided that I will first be addressing DERBY-4009 which is a pre-requisite for DERBY-728. After that I will be implementing an UTF8CcsidManager on the server side and respective tests. Finally I will be adding the code for the manager level negotiation (UNICODEMGR introduces a new manager level)  and for the switching between the two CcsidManagers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-05-30T15:26:44.958+0000","updated":"2010-05-30T15:26:44.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12876356","id":"12876356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"This is my first patch for this issue.\r\n\r\nKathey, we talked about putting in place that setDatabaseName() method as one functional patch. However, that has already been checked-in.\r\n\r\nAs such, what this patch does is set the dbname and shortDbName fields to private. Being protected meant that there were classes that could bypass the setDatabaseName() and set the name directly to the attribute.\r\n\r\nThis is usually a bad idea so I encapsulated the fields with getters and setters to enforce the setDatabaseName() method.\r\n\r\nI will be running regressions today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-07T18:33:17.154+0000","updated":"2010-06-07T18:33:17.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12876785","id":"12876785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"The regressions ran without issues for DERBY-728_p1.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-08T19:58:41.850+0000","updated":"2010-06-08T19:58:41.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12877191","id":"12877191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I need to brainstorm a bit here regarding the Utf8CcsidManager class that I have.\r\n\r\nThere's one thing that I didn't implement because of a detail regarding the following method:\r\npublic String convertToUCS2(byte[] sourceBytes, int offset, int numToConvert) { }\r\n\r\nSo far we had this method on the EbcdicCcsidManager and then it's fine because EBCDIC only uses one byte per character at all times. So the offset parameter always works in a consistent way, that is to say that if offset is 5, we are not only getting 5 sourceBytes but also getting exactly 5 characters.\r\n\r\nHowever, when we come to an Utf8CcsidManager, this offset might land straight in the middle of a character; then if we cut a character in half byte-wise, we will end with a totally different character.\r\n\r\nIs it acceptable to consider offset as a number of characters rather than a number of bytes? It works both ways in EBCDIC but for UTF8 it would mean converting the sourceBytes to a String, offsetting it character-wise, and then convert the offsetted String to UCS2.\r\n\r\nAny other ideas anyone might have?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-09T20:33:26.026+0000","updated":"2010-06-09T20:33:26.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12877196","id":"12877196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think from a practical perspective, at least for the server,  the length passed is always going to be on a character border.\r\n\r\nI only looked at the server code, but see the only place where it is ultimately called is from DDMReader.readString();\r\n\r\nprotected String readString () throws DRDAProtocolException\r\n\t{\r\n\t\treturn readString((int)ddmScalarLen);\r\n\t}\r\n\r\nddmScalarLen is what was sent from the client as the actual length of the ddm object, so the length should be good.\r\n\r\nI think it would be good enough to document  this assumption in the javadoc of the method.\r\n\r\nWe could not convert the sourceBytes because the buffer that is being passed is not all data, the rest of it (after offset ++ numToConvert bytes) is just the rest of the empty buffer.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-06-09T20:45:02.219+0000","updated":"2010-06-09T20:45:02.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12878786","id":"12878786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"Here is the list of changes checked in by patch #2:\r\n\r\n- Utf8CcsidManager.java is rolled in for the server - This CCSID manager is not yet really used in practice. Instances are created but no real live code refers to it yet. I'm still unsure about this implementation and this code might change, but I needed to have a draft in place to proceed further.\r\n\r\n- Both DDMWriter and DDMReader now have three CCSID manager attributes. These two classes have one instance of each of the available managers (UTF-8 and EBCDIC) and a reference to the current enabled one (already part of the existing implementation).\r\n\r\nThese two classes also no longer receive a CCSID manager in their constructor. Instead, they default to EBCDIC and whenever required we can setUtf8Ccsid() or revert to EBCDIC by doing setEbcdicCcsid().\r\n\r\n- The DRDAConnThread.java class has also lost its own ccsidManager and will be using the one from its instance of DDMWriter. This class now initializes its DRDAStrings within the initialize() method, as it is only then that we have a DDMWriter available.\r\n\r\n- Finally, the tests ProtocolTest and TestProto have also been changed to accommodate the constructor changes in DDMWriter and DDMReader.\r\n\r\n--\r\n\r\nI will be running regressions tonight. Provided that all goes well and there are no objections to this patch, it is ready for commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-14T22:51:54.655+0000","updated":"2010-06-14T22:51:54.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12878788","id":"12878788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I forgot to mention but this patch aims at laying foundation for the dual CCSID manager possibility but the goal is to not break any of the current code. As I mentioned, the UTF-8 CCSID manager isn't yet being used by live code despite being in place and all going well, the EBCDIC will be the default even after the patch, without anything breaking.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-14T22:55:50.542+0000","updated":"2010-06-14T22:55:50.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12878957","id":"12878957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"The regressions ran with no failures or errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-15T12:26:35.735+0000","updated":"2010-06-15T12:26:35.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12879525","id":"12879525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I'm submitting two patches.\r\n\r\nThe first is a new version of DERBY-728_p2.diff which adds the proper ASF header to my Utf8CcsidManager.\r\n\r\nThe second checks-in a test for the Utf8CcsidManager class and hooks it to the derbynet suite.\r\n\r\nI'll be running regressions again tonight.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-16T21:51:27.912+0000","updated":"2010-06-16T21:51:27.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12879868","id":"12879868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"The regressions ran with no failures using both p2 patches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-17T17:51:25.583+0000","updated":"2010-06-17T17:51:25.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12880329","id":"12880329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Tiago for the patch,  I think the naming of the methods is a bit confusing in the CCSidManger classes the method for example, public String convertToUCS2(byte[] sourceBytes) should probably just be convertToJavaString as as best I can tell that is what it is trying to do.  So  instead of:\r\n\r\nString sourceString = new String(sourceBytes,\"UTF-8\");\r\n           return new String(sourceString.getBytes(\"UTF-16\"),\"UTF-16\");\r\n\r\nI think you could just return sourceString, unless I am missing something entirely.\r\n\r\n  I don't see that the   CcsidManger numToCharRepresentation  is being used anywhere. Could that just be removed?\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-06-18T21:20:20.925+0000","updated":"2010-06-18T21:20:20.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12880357","id":"12880357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"Here are two refreshed patches after discussing the above issue with Kathey on IRC. We agreed that the convertToUCS2 method should actually be called convertToJavaString as we have no real requirement to have UCS2 Strings. As long as they are Java Strings, it should be fine as they won't be sent over the network (not in UCS2 anyway).\r\n\r\nWith this change, the conversion in the Utf8CcsidManager also changes slightly in this patch.\r\n\r\nI've also removed a leftover comment that shouldn't have stayed there.\r\n\r\nIt needs to be said that the naming change should also happen in the client's CcsidManager classes, but I will keep this task for when I do the client changes.\r\n\r\nI'll be running regressions again tonight and post the results in the morning.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-18T23:04:42.245+0000","updated":"2010-06-18T23:04:42.245+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12880564","id":"12880564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"The regressions failed for the last patch. Do NOT commit. The failure was as follows:\r\n\r\nThere was 1 failure:\r\n1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)j\r\nunit.framework.AssertionFailedError: Minion did not start or boot db in 60 secon\r\nds.\r\n----Minion's stderr:\r\nException in thread \"main\" java.lang.NumberFormatException: For input string: \"\"\r\n        at java.lang.NumberFormatException.forInputString(NumberFormatException.\r\njava:48)        at java.lang.Integer.parseInt(Integer.java:470) at java.lang.Int\r\neger.valueOf(Integer.java:528)  at java.lang.Integer.decode(Integer.java:958)at\r\norg.apache.derbyTesting.functionTests.tests.store.BootLockMinion.main(BootLockMi\r\nnion.java:42)\r\n----Minion's stderr ended\r\n        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.waitFo\r\nrMinionBoot(BootLockTest.java:217)\r\n        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBo\r\notLock(BootLockTest.java:130)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\r\njava:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\r\nsorImpl.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:\r\n109)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57\r\n)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\r\nFAILURES!!!\r\nTests run: 1,  Failures: 1,  Errors: 0\r\n\r\nIt is consistent by running the test by itself. I will be analysing the issue and submitting another patch soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-19T22:55:44.076+0000","updated":"2010-06-19T22:55:44.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12880569","id":"12880569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"It seems these errors come from Kathey's r956075 and are unrelated to my patches. Kathey can you confirm this please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-19T23:06:40.834+0000","updated":"2010-06-19T23:06:40.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12881487","id":"12881487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Tiago. I think it would be good to change the convertFromUCS2 methods to convertFromJavaString and I wonder about this method which I think should be called \r\nconvertToChar\r\n\r\npublic char convertToUCS2Char(byte sourceByte) {\r\n        return (char) sourceByte;\r\n    }\r\n\r\n\r\nFor this one should the source byte be in UTF-8 , if so I think a straight cast might be a problem, depending on the default encoding.  Is it needed? I don't see it in EbcdicCcsidManager.\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-06-23T00:36:31.125+0000","updated":"2010-06-23T00:36:31.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12881869","id":"12881869","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I'm attaching two new p2 patches as per Kathey's comments.\r\n\r\nThe convertFromUCS2 methods should indeed be convertFromJavaString as that is what it in fact does. These functions will convert any string to UTF-8 as long as it is a valid Java String.\r\n\r\nI've also removed convertToUCS2Char() as this was an artifact that I saw in Kathey's prototype and decided to keep. I'm removing it for now and coming back to it later on if it becomes necessary. By then I expect to have a better understanding of why it is necessary.\r\n\r\nI will be running regressions again tonight.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-23T20:48:33.462+0000","updated":"2010-06-23T20:48:33.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12882151","id":"12882151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"The regressions ran without failures. I believe the patches are now ready to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-24T13:29:06.167+0000","updated":"2010-06-24T13:29:06.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12882185","id":"12882185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Tiago,\r\n\r\nI committed the patch, but then noticed the test names probably ought to be changed too.\r\ntestConvertFromUCS2 used 0 ms .\r\ntestConvertToUCS2 used 0 ms\r\nTime: 0.593\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-06-24T15:20:04.658+0000","updated":"2010-06-24T15:20:04.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12882288","id":"12882288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"You're right Kathey, I overlooked this. It should be safe to commit straight away, it's just a name change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-24T19:07:28.478+0000","updated":"2010-06-24T19:07:28.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12883046","id":"12883046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"It looks like the new file (Utf8CcsidManager.java) is causing problems with insane builds.  When using SanityManager routines you should always surround the call with a:\r\nif (SanityManager.DEBUG)\r\n    SanityManager.THROWASSERT(...\r\n\r\nThis is so that when a release jar is built with sane=false no SanityManager code is included.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-28T07:05:44.786+0000","updated":"2010-06-28T07:05:44.786+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12883342","id":"12883342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I'm attaching two patches to this issue.\r\n\r\nThe first, DERBY_728_p2_sanity.diff aims at fixing an issue with sanity. I was making calls to the SanityManager without a check to verify that the DEBUG was enabled. A question that remains open is: what do we do with the exception on a sane build? Is it ok to muffle it and only deal with it on insane mode?\r\n\r\n\r\nThe second patch, DERBY_728_p3.diff, should in principle enable UTF-8 support in the server. I'm not sure I've missed something but I'll post a short explanation of what I've done:\r\n\r\n- CodePoint.java\r\nInserted the new code point for UNICODEMGR (0x1C08) as per the ACR and added it to the MGR_CODEPOINTS array.\r\n--\r\n\r\n- NetworkServerControlImpl.java\r\nSet the minimum manager level for the UNICODEMGR in synch with the MGR_CODEPOINTS array.\r\n--\r\n\r\n- AppRequester.java\r\nSet the minimum manager level for the UNICODEMGR in synch with the MGR_CODEPOINTS array.\r\n\r\nAlso added a convenience method that tells us whether the AppRequester depicted by this class supports or not UTF8. This relies on the manager level for UNICODEMGR being greater or equal to 1208. If the requester does not support UTF8, we won't get a UNICODEMGR manager level on the EXCSAT and as such UNICODEMGR will be set to 0 (which means this convenience method will return false).\r\n--\r\n\r\n- DRDAConnThread.java\r\nWhen dealing with the ACCSEC code point and after we send the ACCSECRD reply we check whether the appRequester supports UTF8 and if it does, we enable it through the switchToUtf8() method [also part of the patch]. If it doesn't, make sure it goes back to EBCDIC, to make sure we aren't in UTF8 from the previous connection.\r\n--\r\n\r\nI'm not sure how I'd go about testing this as a client would have to support UTF-8 as well to be able to test it and this is still just the server side implementation. It will be a good test though to see if all regressions pass tonight; tomorrow, provided that this patch seems to be ok, I will do testing with older clients and see what the outcome is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-28T23:02:28.675+0000","updated":"2010-06-28T23:02:28.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12883448","id":"12883448","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"Regressions passed with no failures; I think it's safe to apply at least patch p2_sanity to fix the sanity issues.\r\n\r\nTesting older clients today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-06-29T07:38:49.138+0000","updated":"2010-06-29T07:38:49.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12883689","id":"12883689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Tiago,\r\n\r\nThe only comment I have on the code change is for AppRequester.supportsUtf8Ccsid(), I think == 1208 might be more appropriate than >= and perhaps a static constant would be good.\r\n\r\nFor testing, I think you can use the ProtocolTest  to test if multi byte characters can be used in database name, userid and password, hopefully escaped unicode characters will work in protocol.tests.\r\n\r\nI committed the sanity manager patch. I think it is fine to just ignore for insane builds, because we don't think it can happen and if it did the NPE that would result would be pretty easy to track.\r\n\r\nIt's great to see us so close on the server side!\r\n\r\n\r\nKathey","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-06-29T20:43:37.574+0000","updated":"2010-06-29T20:43:37.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12326016/comment/12930150","id":"12930150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"This feature has made it to the 10.7.1 release so unless bugs are found, I'm taking this issue as resolved and I'm closing it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-11-09T14:54:29.761+0000","updated":"2010-11-09T14:54:29.761+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-728/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06p3j:"}}