{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12674782","self":"https://issues.apache.org/jira/rest/api/latest/issue/12674782","key":"DERBY-6383","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326659","id":"12326659","description":"candidate for Second release for 10.10 branch","name":"10.10.2.0","archived":false,"released":true,"releaseDate":"2014-04-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-10-24 17:35:52.363","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"354404","customfield_12310222":"1_*:*_1_*:*_2055280052_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-11-14T07:28:08.243+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6383/watchers","watchCount":5,"isWatching":false},"created":"2013-10-21T12:33:28.226+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["backport_reject_10_6"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"12.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12393519","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12393519","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12731721","key":"DERBY-6684","self":"https://issues.apache.org/jira/rest/api/2/issue/12731721","fields":{"summary":"Failure in testDERBY5120NumRowsInSydependsForTrigger when upgrading from 10.11.1.0 to trunk","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12378428","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378428","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12679066","key":"DERBY-6417","self":"https://issues.apache.org/jira/rest/api/2/issue/12679066","fields":{"summary":"Dropping a column in 10.7 release when there is a trigger with REFERENCING OLD clause defined on the table gives error \"ERROR 42X05: Table/View 'OLD' does not exist.\".","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12387020","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12387020","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12709795","key":"DERBY-6547","self":"https://issues.apache.org/jira/rest/api/2/issue/12709795","fields":{"summary":"testDERBY5120NumRowsInSydependsForTrigger fails when the starting version of the upgrade trajectory is 10.10.2.0","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12377288","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12377288","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12478632","key":"DERBY-4874","self":"https://issues.apache.org/jira/rest/api/2/issue/12478632","fields":{"summary":"Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-06T00:21:29.112+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I see this problem on 10.8 and higher. To reproduce, create a database with a trigger like this:\r\n\r\nconnect 'jdbc:derby:trigdb;create=true';\r\ncreate table t1(x int, y int);\r\ncreate table t2(x int, y int);\r\ncreate trigger tr after update of x on t1 referencing old table as old insert into t2 select * from old;\r\n\r\nThen run dblook on the database, and you'll see the following output:\r\n\r\n-- ----------------------------------------------\r\n-- DDL Statements for triggers\r\n-- ----------------------------------------------\r\n\r\nCREATE TRIGGER \"APP\".\"TR\" AFTER UPDATE OF \"X\", \"Y\" ON \"APP\".\"T1\" REFERENCING OLD_TABLE AS OLD FOR EACH STATEMENT insert into t2 select * from old;\r\n\r\nNotice that the DDL creates an update trigger for columns X and Y, whereas the original trigger was defined on column X only.\r\n\r\nI see the expected DDL on 10.7.1.1.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"354694","summary":"Update trigger defined on one column fires on update of other columns","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":36,"total":36,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13802842","id":"13802842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"This is actually more serious than dblook showing incorrect information. The trigger that was defined on update of column X does in fact fire on update of column Y as well. The attached script d6383.sql reproduces the bug:\r\n\r\n{noformat}\r\nij> connect 'jdbc:derby:memory:db;create=true';\r\nij> create table t1(x int, y int);\r\n0 rows inserted/updated/deleted\r\nij> create table t2(x int, y int);\r\n0 rows inserted/updated/deleted\r\nij> insert into t1 values (1,2);\r\n1 row inserted/updated/deleted\r\nij> -- create a trigger on update of T1(X)\r\ncreate trigger t1 after update of x on t1 referencing old table as old insert into t2 select * from old;\r\n0 rows inserted/updated/deleted\r\nij> -- update T1(Y), should not fire the trigger\r\nupdate t1 set y = y + 1;\r\n1 row inserted/updated/deleted\r\nij> -- trigger should not fire, so T2 should be empty\r\nselect * from t2;\r\nX          |Y          \r\n-----------------------\r\n1          |2          \r\n\r\n1 row selected\r\n{noformat}\r\n\r\nWith 10.7.1.1 and earlier the final SELECT query returns no rows, which means the trigger had not fired. This is the correct behaviour, I believe.\r\n\r\nWith 10.7.1.4 and higher, the SELECT query returns one row (as seen above), which means the trigger had fired.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-23T12:16:19.083+0000","updated":"2013-10-23T12:16:19.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13802844","id":"13802844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Updated the bug title to reflect that the bug affects how the trigger is fired and not just how it's shown by dblook.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-23T12:18:51.231+0000","updated":"2013-10-23T12:18:51.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13802860","id":"13802860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like the behaviour was changed in this commit:\r\n\r\n{quote}\r\nr1044096 | mamta | 2010-12-09 20:19:42 +0100 (Thu, 09 Dec 2010) | 14 lines\r\n\r\nDERBY-4874 Trigger does not recognize new size of VARCHAR column expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR\r\n\r\nThe trigger action associated with a trigger gets converted as shown in the example below. This transformation happens if the trigger action has REFERENCEs clause.\r\n\tupdate xr.repositoryobjectversion set uname = upper( n.name )\r\n\t  where name = n.name and uname <> upper( n.name );\r\n\tturns into\r\n\tupdate xr.repositoryobjectversion set uname = \r\n\t  upper( CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(3) AS VARCHAR(128)) ) \r\n\t  where name = CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(3) AS VARCHAR(128))\r\nAs can be seen above, there is a CASTing involved which uses the length of the column in trigger table. \r\n\r\nIf say that length is changed by ALTER TABLE after the trigger has been created, that change in the length does not get reflected in the sql associated with the trigger action in the form on SPSDescriptor. In order to fix this, I have made changes which willcause us to regenerate the sql from the trigger action for the SPSDescriptor if we are working with an invalidated row level trigger which uses the REFERENCEs clause.\r\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-23T12:55:42.745+0000","updated":"2013-10-23T12:55:42.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13804439","id":"13804439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I will take a look at this jira","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-10-24T17:35:52.363+0000","updated":"2013-10-24T17:35:52.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13805083","id":"13805083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I will have a patch ready by tomorrow. I found that this issue is for statement triggers. Row triggers work fine. For the reproduction ij script  provided by Knut, if we add a row level trigger as shown below, it will cause the row trigger to fire only when we update the column on which row trigger is defined.\r\n\r\ncreate trigger t2 after update of x on t1 referencing old as old_row for each row insert into t2 values(old_row.x, old_row.y);\r\nupdate t1 set y = y + 1;\r\nselect count(*) from t2;\r\nupdate t1 set x = x + 1;\r\nselect count(*) from t2;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-10-25T06:25:29.877+0000","updated":"2013-10-25T06:25:29.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13807587","id":"13807587","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching a patch to fix the issue. We were incorrectly marking the statement trigger to fire for all the columns on the table rather than the ones identified by the CREATE TRIGGER statement. Next, I will add a junit test and also an upgrade test. But in the meantime, please let me know if there are any comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-10-29T01:59:06.807+0000","updated":"2013-10-29T01:59:06.807+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13808098","id":"13808098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for looking at this bug, Mamta. The suggested fix looks reasonable to me. You might also want to change a comment further up in that method, which implies that only row-level triggers can be defined on specific columns:\r\n{quote}\r\n\t\t\t//This is the most interesting case for us. If we are here, \r\n\t\t\t//then it means that the trigger is defined at the row level\r\n\t\t\t//and a set of trigger columns are specified in the CREATE\r\n\t\t\t//TRIGGER statement. This can only happen for an UPDATE\r\n\t\t\t//trigger.\r\n{quote}\r\n\r\nI stepped through the code in a debugger and found that the code was executed for statement-level triggers too, so the part that says that \"the trigger is defined at the row level\" is not correct.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-29T15:40:51.566+0000","updated":"2013-10-29T15:40:51.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13809748","id":"13809748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Knut, thanks so much for reviewing the patch. \r\n\r\nI am attaching a new patch DERBY6383_patch2_diff.txt(which is not ready for commit). It takes care of Knut's comment and adds a junit test and adds an upgrade test. I am having problems with the upgrade tests and am wondering if the failure rings a bell to anyone. Basically, the junit tests(suites.All which includes upgrade suite)works perfectly fine with my patch **if I disable the newly added upgrade suite in the attached patch**. But if I include my new upgrade fixture in the upgrade suite and run suites.All, I am getting errors similar to DERBY-5947 and DERBY-6203. Further more, some other upgrade tests fail after them but it may be the side effects of the failures seen by DERBY-5947 and DERBY-6203. I am attaching the output of the stand alone upgrade suite(upgradeTests._Suite) run for reference(this upgrade suite was run with my newly added upgrade test in the patch) as runall.out. Additionally, I have also attached error-stacktrace and derby.log for testTriggers and testDisposableStatisticsExplicit.\r\n\r\nI will try to narrow down the releases that we include for upgrade suite to see if I can have a shorter upgrade suite to share which runs into the problems I am experiencing. Appreciate all the help. Thanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-10-30T23:23:14.541+0000","updated":"2013-10-30T23:23:14.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13810190","id":"13810190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think this failure means the test change made the create phase corrupt the SYSSTATEMENTS table when running the upgrade tests against 10.5.1.1, 10.5.3.0, 10.6.1.0 or 10.6.2.1. The corruption happens because of DERBY-4577. When the upgrade test tries to boot the corrupted database in soft upgrade mode, an assert added in DERBY-4577 detects the corruption and raises an error.\r\n\r\nSince the corruption happens in old, already released versions of Derby, and it's too late to fix the bug in those versions now, I think we could just disable this test case if the old version suffers from DERBY-4577 (that is, older than 10.7.1.1).\r\n\r\nActually, I don't think this is the kind of bug fix where we usually add an upgrade test. The patch doesn't attempt to fix this problem for existing triggers on upgrade (I don't think it could, since the information about which columns the original CREATE TRIGGER statement specified is lost). The main difference between the upgrade test case and the TriggerTest test case seems to be that the upgrade test case verifies that CREATE TRIGGER doesn't work as expected on some specific old versions. Since the behaviour of the already released versions is never going to change, we don't need to spend time testing that behaviour. The testing of the behaviour of the new version looks more or less the same as what was added to TriggerTest, so maybe it would be good enough coverage if we simply skipped the upgrade test case. Then we'd avoid the problem of having to find a workaround for DERBY-4577 altogether.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-31T12:24:37.491+0000","updated":"2013-10-31T12:24:37.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13810528","id":"13810528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Knut, you are right about upgrade test demonstrating what does not work in releases with defect DERBY-6383 and newly created triggers on soft-upgraded or hard-upgraded triggers working correctly. I will go ahead and remove the upgrade test so we don't need to find a workaround to DERBY-4577. Also, I will go ahead and create a new jira to see if we can add another column to SYSTRIGGERS table to save the CREATE TRIGGER sql for cases like this jira. This saved sql can be used in tiring to fix the bugs by recreating the SYSTRIGGERS row information if needed during soft-upgrade or hard-upgrade. In this jira, the only way to fix the problem is to manually drop and recreate the STATEMENT triggers after sof/hard upgrade since we do not have information on what columns the CREATE TRIGGER was created on.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-10-31T18:32:02.882+0000","updated":"2013-10-31T18:32:02.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13810588","id":"13810588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1537593 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1537593 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns). \r\n\r\nThis regression is caused by DERBY-4874(Trigger does not recognize new size of VARCHAR column expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was\r\nencountered trying to shrink VARCHAR)\r\n\r\nThe regression is for Statement level triggers. The statement trigger gets fired incorrectly for any column update rather than just the column specified in the UPDATE of column clause. The fix is going to ensure that SYSTRIGGERS has the correct list of columns on which trigger should be fired. Row level triggers work fine. The only workaround at this point is to drop and recreate the statement triggers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-10-31T19:29:02.592+0000","updated":"2013-10-31T19:29:02.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13811340","id":"13811340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think I'd prefer not to add an extra column to SYSTRIGGERS. If similar bugs turn up (fingers crossed that they don't!), we can always tell users to drop and recreate the trigger after upgrade, just like we'll tell them that they'll have to do that to work around this bug. I'm worried that adding more redundancy in the system tables and more upgrade logic just in anticipation of future bugs (bugs that we don't know what will look like) might cause more problems than they will help if/when a situation where they are useful arises. In the case where a CREATE operation is buggy, I'm fine with having to recreate the object to get it fixed. After all, triggers are no special in this regard, so if we add such a column to SYSTRIGGERS, we should probably add such columns to other system tables too in case CREATE TABLE, CREATE TYPE or any other CREATE operation turns out to have a problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-01T15:25:10.648+0000","updated":"2013-11-01T15:25:10.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13811541","id":"13811541","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I think the commit of revision 1537593 caused failures in the derbyall dblook tests, both for client and embedded, see for instance:\r\nhttp://download.java.net/javadesktop/derby/request_5583609/javadb-task-3751113.html\r\nor \r\nhttp://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm16/1537799-derbyall_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-11-01T18:35:57.944+0000","updated":"2013-11-01T18:35:57.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13813556","id":"13813556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1538854 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1538854 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nFollowing old harness tests need their master files updated after the code changes for DERBY-6383. Now the behavior of these master match those of 10.6 codeline where DERBY-6383 regression does not exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-05T02:04:46.973+0000","updated":"2013-11-05T02:04:46.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13813557","id":"13813557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1538854 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1538854 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nFollowing old harness tests need their master files updated after the code changes for DERBY-6383. Now the behavior of these master match those of 10.6 codeline where DERBY-6383 regression does not exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-05T02:05:04.314+0000","updated":"2013-11-05T02:05:04.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13813558","id":"13813558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1538854 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1538854 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nFollowing old harness tests need their master files updated after the code changes for DERBY-6383. Now the behavior of these master match those of 10.6 codeline where DERBY-6383 regression does not exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-05T02:05:23.421+0000","updated":"2013-11-05T02:05:23.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13813611","id":"13813611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Working on backporting upto 10.7","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-05T04:02:21.899+0000","updated":"2013-11-05T04:02:21.899+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13814060","id":"13814060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1539074 from [~mamtas] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1539074 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting following 2 revisions from trunk to 10.10. Had to hand do the changes because of conflicts during svn merge.\r\n1537593, 1538854","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-05T17:24:32.232+0000","updated":"2013-11-05T17:24:32.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13814168","id":"13814168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1539108 from [~mamtas] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1539108 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\n2 master updates","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-05T19:29:33.906+0000","updated":"2013-11-05T19:29:33.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13814574","id":"13814574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1539228 from [~mamtas] in branch 'code/branches/10.9'\r\n[ https://svn.apache.org/r1539228 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting to 10.9","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-06T03:35:58.067+0000","updated":"2013-11-06T03:35:58.067+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13816288","id":"13816288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I spent some time analyzing the triggers and systriggers system table to see if we can help identify precisely which triggers need to be dropped and recreated. \r\n\r\nsystriggers table has a column called REFERENCEDCOLUMNS which keeps track of the columns on which triggers should get fired.\r\n\r\nFor update triggers defined at statement level on specific columns, this column will keep position of those columns in the REFERENCEDCOLUMNS column. eg\r\ncreate table t1(x int, y int);\r\ncreate table t2(x int, y int);\r\ncreate trigger tr1 after update of x on t1 referencing old table as old insert into t2 select * from old;\r\nREFERENCEDCOLUMNS for the above trigger should be (1) but because of DERBY-6383, it is (1,2) and thus causing the trigger to fire no matter which column gets updated rather than just for column x. I have added a junit test case for this scenario showing that after the fix for DERBY-6383 is checked in, we do not fire the trigger above for update of column y. Although, if a new column is added to the column after the trigger above is created, an update of the newly added column will not fire the trigger defined above because \r\nREFERENCEDCOLUMNS does not have the position of the newly added column listed in it. I will add a junit test for newly added column for update triggers defined at statement level on specific columns.\r\n\r\nFor update triggers defined at statement level on table level rather than specific columns, this column should be null eg\r\ncreate trigger tr2 after update on t1 referencing old table as old insert into t2 select * from old;\r\nREFERENCEDCOLUMNS for the above trigger should be null since it should fire for any column update but because of DERBY-6383, it is (1,2) which does not cause any problem for the given eg because we want this trigger to fire whether column x or y got updated. But if we add another column to table t1, an update of that column will not fire the trigger above because REFERENCEDCOLUMNS is not null. I will add a junit test case for this scenario to show that after the fix for DERBY-6383 is checked in, the trigger tr2 will get fired for an update of new column added after the trigger creation.\r\n\r\nI will also add junit test cases for drop column scenario to confirm update triggers work fine.\r\n\r\nBased on this information, all statement level update triggers will need to be dropped and recreated in order to fix the buggy triggers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-07T19:09:26.273+0000","updated":"2013-11-07T19:09:26.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13816290","id":"13816290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I will update release notes based on the findings of the earlier comment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-07T19:09:53.768+0000","updated":"2013-11-07T19:09:53.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13817540","id":"13817540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"DERBY6383_patch3_diff.txt which has number of junit tests, mainly to test out add/drop column's impact on triggers. Want to point out that from drop column test case in testDerby6383StatementTriggerBugTst1, in trunk, the drop column drops the statement trigger defined at  table level in trunk but not in 10.6. This may be what DERBY-3940(Dropping a column does not drop triggers which mention that column) is. DERBY-3940 has been verified to be fixed in trunk and 10.10 but we do not for sure for earlier codelines. I will work on trying out the test case attached to DERBY-3940 on 10.6 and other higher codelines. But if anyone knows about it, may be they can explain the difference in behavior of drop column on trigger table in trunk vs 10.6 Thanks\r\n+\r\n+        //Drop a column from the table. Following will drop trigger t3\r\n+        // because it depends on column being dropped. But trigger t2\r\n+        // will remain intact since it does not have dependency on\r\n+        // column being dropped. So only trigger left at this point\r\n+        // will be t2 after the following column drop\r\n+        s.executeUpdate(\"ALTER TABLE DERBY_6368_TAB1 DROP COLUMN Y\");\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-08T18:17:53.248+0000","updated":"2013-11-08T18:17:53.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13817585","id":"13817585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Investigating more about drop column and its impact on statement level trigger defined at the table level might be DERBY-4988(ALTER TABLE DROP COLUMN should make use of information in SYSTRIGGERS to detect column used through REFERENCING clause to find trigger dependencies). A simple test case below which works correctly in trunk through 10.7 but not in 10.6(and probably earlier codelines). I will create a new jira for this specific drop column case.\r\njava org.apache.derby.tools.ij\r\nconnect 'jdbc:derby:db1;create=true';\r\nCREATE TABLE DERBY_6368_TAB1 (X INTEGER, Y INTEGER);\r\nCREATE TABLE DERBY_6368_TAB2 (X INTEGER, Y INTEGER);\r\nINSERT INTO  DERBY_6368_TAB1 VALUES(1, 2);\r\n\r\n-- statement trigger defined at table level\r\nCREATE TRIGGER t3 AFTER UPDATE ON DERBY_6368_TAB1 REFERENCING old table AS old INSERT INTO DERBY_6368_TAB2 SELECT * FROM old;\r\n\r\n--1 row\r\nUPDATE DERBY_6368_TAB1 SET x = x + 1;\r\nselect count(*) from DERBY_6368_TAB2;\r\ndelete from DERBY_6368_TAB2;\r\n\r\n-- following should drop the statement trigger defined above but it does not do that in 10.6 and earlier codelines\r\nALTER TABLE DERBY_6368_TAB1 DROP COLUMN Y;\r\nALTER TABLE DERBY_6368_TAB2 DROP COLUMN Y;\r\nselect * from sys.systriggers;\r\n\r\nUPDATE DERBY_6368_TAB1 SET x = x + 1;\r\n--count should be 0 but in 10.6 and earlier, the update fires the trigger since the trigger didn't get dropped\r\nselect count(*) from DERBY_6368_TAB2;","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-08T19:08:31.344+0000","updated":"2013-11-08T19:37:16.081+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13819832","id":"13819832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1540947 from [~mamtas] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1540947 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T05:00:38.084+0000","updated":"2013-11-12T05:00:38.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820263","id":"13820263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541167 from [~mamtas] in branch 'code/branches/10.7'\r\n[ https://svn.apache.org/r1541167 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting to 10.7","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T17:15:48.277+0000","updated":"2013-11-12T17:15:48.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820264","id":"13820264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541170 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1541170 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nAdding more junit tests for checking the affects of adding/dropping columns to the table with update triggers defined on it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T17:18:45.652+0000","updated":"2013-11-12T17:18:45.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820269","id":"13820269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"No further backporting beyond 10.7 is needed because this regression does not exist in those codelines.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-12T17:23:21.203+0000","updated":"2013-11-12T17:23:21.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820497","id":"13820497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541245 from [~mamtas] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1541245 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting more junit tests from trunk for checking the affects of adding/dropping columns to the table with update triggers defined on it","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T21:30:12.629+0000","updated":"2013-11-12T21:30:12.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820512","id":"13820512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541252 from [~mamtas] in branch 'code/branches/10.9'\r\n[ https://svn.apache.org/r1541252 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nbackporting tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T21:52:00.651+0000","updated":"2013-11-12T21:52:00.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13820525","id":"13820525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541254 from [~mamtas] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1541254 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nbackporting tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T22:00:25.112+0000","updated":"2013-11-12T22:00:25.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13821618","id":"13821618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backport of the junit test to 10.7 gives error because of DERBY-6417. The test for ALTER TABLE .. DROP COLUMN is giving incorrect behavior in 10.7. I will comment out that part of the test and make any needed changes to backport hopefully the rest of the junit test to 10.7. Code changes for this jira are already in 10.7","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-11-13T18:12:20.426+0000","updated":"2013-11-13T18:12:20.426+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13822227","id":"13822227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541837 from [~mamtas] in branch 'code/branches/10.7'\r\n[ https://svn.apache.org/r1541837 ]\r\n\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nbackporting part of the junit tests added for DERBY-6383. Had to comment out couple drop column related tests because of DERBY-6417(Dropping a column in 10.7 release when there is a trigger with REFERENCING OLD clause defined on the table gives error \"ERROR 42X05: Table/View 'OLD' does not exist.\".) in 10.7 codeline","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-14T07:24:26.687+0000","updated":"2013-11-14T07:24:26.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13946457","id":"13946457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The release note says that a regression was introduced by DERBY-6383. Shouldn't that be some older issue like DERBY-4874?\r\n\r\nAlso, in the \"Incompatibilities with Previous Release\" section, I think that the following phrase\r\n\r\nfor columns not specified CREATE TRIGGER... AFTER UPDATE.. OF columns-list\r\n\r\nwould read better as\r\n\r\nfor columns not specified in the column list of the \"CREATE TRIGGER... AFTER UPDATE.. OF\" clause\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-03-25T12:33:18.185+0000","updated":"2014-03-25T12:33:18.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/13948494","id":"13948494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a modified version of the release notes that attempts to address Rick's findings.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-03-26T21:28:23.147+0000","updated":"2014-03-26T21:28:23.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674782/comment/14004294","id":"14004294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1596451 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1596451 ]\r\n\r\nDERBY-6547(testDERBY5120NumRowsInSydependsForTrigger fails when the starting version of the upgrade trajectory is 10.10.2.0)\r\n\r\n10.10, 10.9 and 10.8 jars started failing in upgrade suite(in testDERBY5120NumRowsInSydependsForTrigger) after following was backported into those codelines\r\n*****\r\nDERBY-6383(Update trigger defined on one column fires on update of other columns)\r\n\r\nBackporting following 2 revisions from trunk to 10.10. Had to hand do the changes because of conflicts during svn merge.\r\n1537593, 1538854 \r\n*****\r\n\r\nThe reason behind the failure is actually how testDERBY5120NumRowsInSydependsForTrigger test was written and not a code regression. \r\n\r\nThe test creates a trigger which is supposed to fire on a specific column\r\n\tcreate trigger ATDC_TAB1_TRG1 after update of C11 on ATDC_TAB1 REFERENCING old_table as old \r\n        \tfor each statement MODE DB2SQL insert into ATDC_BKUP1 select * from old\r\nBut later on it the test, it is expecting the trigger to fire on update of non-trigger column of the table. This was fine before DERBY-6383 was backported because w/o the fix for DERBY-6383, triggers would fire on update of any column on the table(DERBY-6383 - Update trigger defined on one column fires on update of other columns). But after those codelines got the fix for DERBY-6383 as part of the backport, the trigger correctly won't fire any more on non-trigger columns and that started the test failure. I have fixed the test to update the trigger column in order to fire the trigger and now the test behaves correctly. I will backport this test fix upto 10.8 codelines which is how far DERBY-6383 got backported to.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-05-21T03:37:01.642+0000","updated":"2014-05-21T03:37:01.642+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6383/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1p3lj:"}}