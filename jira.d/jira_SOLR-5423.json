{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12677541","self":"https://issues.apache.org/jira/rest/api/latest/issue/12677541","key":"SOLR-5423","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326521","id":"12326521","description":"Bugfix release after 4.7","name":"4.7.1","archived":false,"released":true,"releaseDate":"2014-04-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326254","id":"12326254","description":"Major release after 4.7","name":"4.8","archived":false,"released":true,"releaseDate":"2014-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-02-03 13:33:37.198","customfield_12312323":null,"customfield_12310420":"356916","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9656624783_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-02-25T04:36:01.913+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5423/watchers","watchCount":5,"isWatching":false},"created":"2013-11-05T10:12:17.183+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324324","id":"12324324","description":"Major release after 4.3","name":"4.4","archived":false,"released":true,"releaseDate":"2013-07-23"}],"issuelinks":[{"id":"12377987","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12377987","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12431022","key":"SOLR-1298","self":"https://issues.apache.org/jira/rest/api/2/issue/12431022","fields":{"summary":"FunctionQuery results as pseudo-fields","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-04-02T15:03:39.269+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"Given a schema with \r\n\r\n   <field name=\"price\"  type=\"float\" indexed=\"true\" stored=\"true\"/>\r\n   <field name='numpages' type='int' indexed='true' stored='true'/>\r\n  \r\nthe following query returns no rows:\r\n\r\nhttp://localhost:8983/solr/collection1/select?q=*%3A*&rows=30&fl=div(price%2Cnumpages)&wt=csv&indent=true\r\n\r\nHowever, setting wt=json or wt=xml, it works.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"357206","summary":"CSV output doesn't include function field","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwilson_shutterstock","name":"jwilson_shutterstock","emailAddress":"jwilson at shutterstock dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Wilson","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwilson_shutterstock","name":"jwilson_shutterstock","emailAddress":"jwilson at shutterstock dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Wilson","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13889470","id":"13889470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"Fix for the csv output doesn't work for function fields","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-03T13:33:37.198+0000","updated":"2014-02-03T13:33:37.198+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13889471","id":"13889471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"I have fixed this issue. Attached the patch file for the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-03T13:33:47.979+0000","updated":"2014-02-03T13:33:47.979+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13893715","id":"13893715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Hey Arun, some comments about your patch:\r\n\r\n* please generate patches against he entire code base so they are easier to apply & review: https://wiki.apache.org/solr/HowToContribute#Generating_a_patch\r\n* can you explain what's going on with the getOriginalNameForFunctionField function in your patch? ... it seems extremely sketchy.  if the problem is just that ValueSourceAugmenter's \"getName\" doesn't match the actual fieldname the transformer puts in the modified documents, we should fix that in ValueSourceAugmenter\r\n* in general, the amount of instanceof checking going on in your patch seems really brittle, and i'm not exactly sure why it's neccessary.  As I understand it the CSVResponseWriter already loops over all of the field names in the documents to be returned to get the list of column names it should output -- so as long as the transformer logic is applied before that, then won't the field names be picked up automatically?\r\n\r\nindependent of any of the above questions about this patch, we shouldn't move forward with committing support for transformers to the csv repsonse writer w/o having some tests that prove it works.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2014-02-06T19:47:54.334+0000","updated":"2014-02-06T19:47:54.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13894474","id":"13894474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"Generated the patch at the project root level with proper naming convention","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-07T12:55:02.917+0000","updated":"2014-02-07T12:55:02.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13894495","id":"13894495","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"Hi Hoss,\r\n\r\nThanks for your review. I have attached the patch generated at the root level and followed the naming convention for the file.\r\n\r\nHere are my inputs on your other comments:\r\n\r\nThe reason for including a new method getOriginalNameForFunctionField is the ValueSourceAugmenter.getName() returns the name with a function prefix to it, as like this. \r\n\r\n public String getName()\r\n  {\r\n    return \"function(\"+name+\")\";\r\n  }\r\n\r\nWe can't change this method directly as it has been referred in few other places in the code, it may break other places. Even I thought of including a new method in ValueSourceAugmenter as getOriginalName(){return name;} but for this we have to change the abstract class DocTransformer and should implement this new method in all the child classes which are extending DocTransformer. So I dropped this option and wrote a method specific to CSVResponseWriter.\r\n\r\nOn number of instanceof used, in writeResponse method of CSVResponseWriter the responseObj type is coming as ResultContext only when we have functions in the query. so I am filtering the ResultContext instance and then the other two instanceof is required when one function is present in the query then the transformer type is of ValueSourceAugmenter and if we have multiple functions in the same query then the transformer type is DocTransformers (array of ValueSourceAugmenter) so we need to check these instanceof to process accordingly. In general the transformer logic followed for xml/json is different than the csv. In csv we don't have headers and the format also simple. Because of this difference the transformers are not considering the function field as a field for the csv type. Please let me know if there are any other better way to handle this.\r\n\r\nOn the test case, yes I can write a unit test case to prove this fix works. \r\n\r\nThanks,\r\nArun","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-07T13:14:58.662+0000","updated":"2014-02-07T13:14:58.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13898049","id":"13898049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"Attached the updated patch with a supporting unit test to test the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-11T17:25:00.866+0000","updated":"2014-02-11T17:25:00.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13900808","id":"13900808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Hi Arun,\r\n\r\n1. About  {{getOriginalNameForFunctionField()}} - Hoss wrote:\r\n\r\nbq.  if the problem is just that ValueSourceAugmenter's \"getName\" doesn't match the actual fieldname the transformer puts in the modified documents, we should fix that in ValueSourceAugmenter\r\n\r\nand then you wrote:\r\n\r\nbq. We can't change this method directly as it has been referred in few other places in the code, it may break other places.\r\n\r\nThat's not a problem, you can fix them in those other places.\r\n\r\n2. About instanceof - Hoss wrote:\r\n\r\nbq. in general, the amount of instanceof checking going on in your patch seems really brittle, and i'm not exactly sure why it's neccessary. As I understand it the CSVResponseWriter already loops over all of the field names in the documents to be returned to get the list of column names it should output â€“ so as long as the transformer logic is applied before that, then won't the field names be picked up automatically?\r\n\r\nIf you look at the loop Hoss describes, where {{fields}} are pulled from the response documents (starting at line #244 in your patched version of {{CSVResponseWriter.java}}), you shouldn't need to do any of the transformer interrogation you're doing at all.  Maybe the condition around the loop needs to be expanded to include cases when there are function fields ({{returnFields.getTransformer() != null}} or something like that)?\r\n\r\n3. Unit tests: you added one case, but I'd suggest you add a few more, e.g. the one in this issue's description, where there is no field renaming.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2014-02-13T22:22:48.331+0000","updated":"2014-02-13T22:22:48.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13902446","id":"13902446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"body":"Hi Steve,\r\n\r\nThanks for your review, I have attached an updated patch.\r\n\r\n1. I removed the new method getOriginalNameForFunctionField() instead as you suggested I updated the getName() of ValueSourceAugmenter. There are no impacts because of this change, I tested the unit test case\r\ncovering this ValueSourceAugmenter.\r\n\r\n2. Made correction as you & Hoss suggested\r\n\r\n3. Covered additional unit test without alias names and single/multiple functions in query\r\n\r\n-Arun","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arun_mist","name":"arun_mist","emailAddress":"arun at mistminds dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Kumar","active":true},"created":"2014-02-15T16:01:44.736+0000","updated":"2014-02-15T16:01:44.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13908547","id":"13908547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Hi Arun,\r\n\r\nWhen you post patches, you don't need to remove older versions - in fact, you shouldn't - JIRA will gray out older same-named files, and people can see the evolution of proposed changes.  You can see that with the patch file I'm attaching now - your most recent one and mine are both there.  If you hover your mouse pointer over an attachment file name, you can see some metadata about it in the tooltip: who posted it and when.\r\n\r\nIn looking at your patch, I noticed that your solution of appending fields by getting their names from the corresponding transformers would put fields in the wrong order if a function pseudofield is not last in the requested fields list.  I reordered the requested fields in one of your tests to illustrate this problem.\r\n\r\nHoss's and my comments about the get-all-fields-from-the-docs loop already having access to all fields was wrong, because the transformation logic happens later, at the end of {{CSVResponseWriter.writeResponse()}}, in the call to {{TextResponseWriter.writeDocuments()}}.  Even if we had been right, appending fields in an order different from the requested order would have been wrong.  \r\n\r\nSo the field ordering problem has to be fixed based on the actual requested fields list.  The attached patch handles this in {{SolrReturnFields}}, where the requested fields list is parsed, by putting function pseudofields into the (ordered) requested field names - at present, the only consumer of this is {{CSVWriter.writeResponse()}}.  This solution doesn't need to change {{CSVResponseWriter}} itself at all.  I also added a test to {{ReturnFieldsTest}}.\r\n\r\nI think this is ready to go.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2014-02-21T17:24:00.329+0000","updated":"2014-02-21T17:24:00.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13911072","id":"13911072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1571505 from [~steve_rowe] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1571505 ]\r\n\r\nSOLR-5423: CSV output doesn't include function field","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-25T01:03:08.451+0000","updated":"2014-02-25T01:03:08.451+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13911238","id":"13911238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1571559 from [~steve_rowe] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1571559 ]\r\n\r\nSOLR-5423: CSV output doesn't include function field (merged trunk r1571505)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-25T04:33:45.357+0000","updated":"2014-02-25T04:33:45.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13911243","id":"13911243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Committed to trunk and branch_4x.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2014-02-25T04:36:01.946+0000","updated":"2014-02-25T04:36:01.946+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13945253","id":"13945253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"I'll backport this to 4.7.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2014-03-24T15:51:05.877+0000","updated":"2014-03-24T15:51:05.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13945455","id":"13945455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1580965 from [~steve_rowe] in branch 'dev/branches/lucene_solr_4_7'\r\n[ https://svn.apache.org/r1580965 ]\r\n\r\nSOLR-5423: CSV output doesn't include function field (merged branch_4x r1571559)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-03-24T18:19:15.363+0000","updated":"2014-03-24T18:19:15.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13945461","id":"13945461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1580967 from [~steve_rowe] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1580967 ]\r\n\r\nSOLR-5423: move CHANGES.txt entry to 4.7.1 section","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-03-24T18:20:00.047+0000","updated":"2014-03-24T18:20:00.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13945465","id":"13945465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1580969 from [~steve_rowe] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1580969 ]\r\n\r\nSOLR-5423: move CHANGES.txt entry to 4.7.1 section (merged trunk r1580967)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-03-24T18:21:34.997+0000","updated":"2014-03-24T18:21:34.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677541/comment/13957747","id":"13957747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Bulk close 4.7.1 issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2014-04-02T15:03:39.266+0000","updated":"2014-04-02T15:03:39.266+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5423/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pj2v:"}}